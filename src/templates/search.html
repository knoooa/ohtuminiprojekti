{% extends "layout.html" %}
{% block title %}Advanced Search{% endblock %}

{% block body %}
<h1>Advanced Citation Search</h1>

<p><a href="/">Back</a></p>

<form method="get" action="/citations/search" class="search-form">

  <h3>General Search</h3>
  <input type="text" name="q" placeholder="Search all fields (full text)…" value="{{ request.args.get('q','') }}">

  <h3>Basic Filters</h3>
  <input type="text" name="citation_key" placeholder="Citation key…" value="{{ request.args.get('citation_key','') }}">

  <select name="entry_type">
    <option value="">Any entry type</option>
    {% for et in entry_types %}
    <option value="{{ et.name }}" {% if et.name==request.args.get('entry_type') %}selected{% endif %}>
      {{ et.name }}
    </option>
    {% endfor %}
  </select>

  <h3>Author</h3>
  <input type="text" name="author" placeholder="Author name…" value="{{ request.args.get('author','') }}">

  <h3>Year Range</h3>
  <input type="number" name="year_from" placeholder="From year" value="{{ request.args.get('year_from','') }}">

  <input type="number" name="year_to" placeholder="To year" value="{{ request.args.get('year_to','') }}">

  <h3>Sorting</h3>
  <select name="sort_by">
    <option value="">Default</option>
    <option value="year" {% if request.args.get('sort_by')=="year" %}selected{% endif %}>Year</option>
    <option value="citation_key" {% if request.args.get('sort_by')=="citation_key" %}selected{% endif %}>Citation Key
    </option>
  </select>

  <select name="direction">
    <option value="asc" {% if request.args.get('direction')=="asc" %}selected{% endif %}>Ascending</option>
    <option value="desc" {% if request.args.get('direction')=="desc" %}selected{% endif %}>Descending</option>
  </select>

  <br><br>
  <button type="submit">Search</button>
</form>

<hr>

<h2>Results</h2>

{% if citations %}
{% for c in citations %}
<div class="citation" id="{{ c.id }}-{{c.citation_key}}">
  <p>@{{ c.entry_type }} &mdash; {{ c.citation_key }}: {{ c.to_human_readable() }}</p>
  <br>
  <form method="GET" action="{{ url_for('edit_citation', citation_id=c.id) }}" style="display:inline;">
    <button type="submit">Edit</button>
  </form>
  <form method="POST" action="{{ url_for('delete_citation', citation_id=c.id) }}" style="display:inline;">
    <button type="submit" onclick="return confirm('Are you sure you want to delete this citation?')">Delete</button>
  </form>
  <form method="GET" action="{{ url_for('show_bibtex', citation_id=c.id) }}" style="display:inline;">
    <button type="submit">View BibTeX</button>
  </form>
</div>
<hr>
{% endfor %}
{% else %}
<p>No results found.</p>
{% endif %}

{% endblock %}
