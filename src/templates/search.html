{% extends "layout.html" %}
{% block title %}Advanced Search{% endblock %}

{% block body %}
<h1>ğŸ” Search Citations</h1>
<div class="nav-links">
  <a href="{{ url_for('citations_view') }}">View All Citations</a>
  <a href="{{ url_for('index') }}">Create New Citation</a>
</div>

<form method="get" action="/citations/search" class="search-form">

  <h3>General Search</h3>
  <input type="text" name="q" placeholder="Search all fields (full text)â€¦" value="{{ request.args.get('q','') }}">

  <h3>Basic Filters</h3>
  <label>Citation Key:
    <input type="text" name="citation_key" placeholder="Enter citation keyâ€¦" value="{{ request.args.get('citation_key','') }}">
  </label>

  <label>Entry Type:
    <select name="entry_type">
      <option value="">Any entry type</option>
      {% for et in entry_types %}
      <option value="{{ et.name }}" {% if et.name==request.args.get('entry_type') %}selected{% endif %}>
        {{ et.name }}
      </option>
      {% endfor %}
    </select>
  </label>

  <h3>Author</h3>
  <input type="text" name="author" placeholder="Enter author nameâ€¦" value="{{ request.args.get('author','') }}">

  <h3>Year Range</h3>
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
    <input type="number" name="year_from" placeholder="From year" value="{{ request.args.get('year_from','') }}">
    <input type="number" name="year_to" placeholder="To year" value="{{ request.args.get('year_to','') }}">
  </div>

  <h3>Sorting</h3>
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
    <select name="sort_by">
      <option value="">Default</option>
      <option value="year" {% if request.args.get('sort_by')=="year" %}selected{% endif %}>Year</option>
      <option value="citation_key" {% if request.args.get('sort_by')=="citation_key" %}selected{% endif %}>Citation Key
      </option>
    </select>

    <select name="direction">
      <option value="asc" {% if request.args.get('direction')=="asc" %}selected{% endif %}>Ascending</option>
      <option value="desc" {% if request.args.get('direction')=="desc" %}selected{% endif %}>Descending</option>
    </select>
  </div>

  <div style="margin-top: 20px;">
    <button type="submit" class="btn-success">ğŸ” Search</button>
    <a href="{{ url_for('citations_search') }}" style="display: inline-block; padding: 12px 24px; background: #6c757d; color: white; border-radius: 6px; text-decoration: none; font-weight: 500;">Clear Filters</a>
  </div>
</form>

<hr>

<h2>Search Results</h2>

{% if citations %}
<p style="color: #666; font-size: 16px; margin-bottom: 20px;">
  <strong>{{ citations|length }}</strong> citation(s) found
</p>
{% for c in citations %}
<div class="citation" id="{{ c.id }}-{{c.citation_key}}">
  <p><strong>@{{ c.entry_type }}</strong> &mdash; <strong>{{ c.citation_key }}</strong></p>
  <p style="margin-top: 8px;">{{ c.to_human_readable() }}</p>
  <div style="margin-top: 12px;">
    <form method="GET" action="{{ url_for('edit_citation', citation_id=c.id) }}" style="display:inline;">
      <button type="submit">âœï¸ Edit</button>
    </form>
    <form method="POST" action="{{ url_for('delete_citation', citation_id=c.id) }}" style="display:inline;">
      <button type="submit" class="btn-danger" onclick="return confirm('Are you sure you want to delete this citation?')">ğŸ—‘ï¸ Delete</button>
    </form>
    <form method="GET" action="{{ url_for('show_bibtex', citation_id=c.id) }}" style="display:inline;">
      <button type="submit" class="btn-secondary">ğŸ“„ View BibTeX</button>
    </form>
  </div>
</div>
{% endfor %}
{% else %}
<div style="text-align: center; padding: 60px 20px; background: #f8f9fa; border-radius: 8px; margin-top: 30px;">
  <h2 style="color: #999;">No results found</h2>
  <p style="color: #999; margin: 20px 0;">Try adjusting your search criteria.</p>
</div>
{% endif %}

{% endblock %}
